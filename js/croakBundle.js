export function getDistanceStories(e,t,r){let o=e.getBoundingClientRect().right;e.parentElement.querySelectorAll("video").forEach((e=>{e.removeAttribute("autoplay"),e.pause()})),void 0===r&&(r=!1);let n=e.querySelector("video");n&&e.classList.contains("stories-el_active")&&(n.setAttribute("autoplay",!0),n.play());let i=t.getBoundingClientRect().width/2-o;const l=t.getBoundingClientRect(),s=e.getBoundingClientRect(),d=-(i+l.left+s.width/2);t.style.transform=`translate3d(${-d}px, -50%, 0)`;let a=t.scrollWidth,c=t.parentElement,u=c.clientWidth,m=0,p=!1,w=-d,b=0,y=0,g=u-a;function v(e){p=!1,t.style.cursor="grab",w=-b,t.querySelectorAll(".galleri__el").forEach((e=>{e.style.pointerEvents="initial"})),y=0}window.innerWidth>=768&&window.deskSwipe&&(c.addEventListener("mousedown",(function(e){e.preventDefault(),t.style.cursor="grabbing",p=!0,m=e.clientX})),c.addEventListener("mousemove",(function(e){if(e.preventDefault(),!p)return;0===y&&(t.querySelectorAll(".galleri__el").forEach(((e,t,r)=>{e.classList.remove("stories-el_active"),e.style.pointerEvents="none",e.parentElement.querySelectorAll("video").forEach((e=>{e.removeAttribute("autoplay"),e.pause()}))})),y++),b=m-e.clientX-w;let r=-b;b<-(a-u)&&(b+=r-(a-u+20)),r<g&&(b+=r-(g-20)),t.style.transform=`translate3d(${-b}px, ${-t.getBoundingClientRect().height/2}px, 0)`,console.log(window.deskSwipeFocus),window.deskSwipeFocus&&(console.log("ckecher"),t.querySelectorAll(".galleri__el").forEach(((e,t,r)=>{!function(e){console.log("checker");let t=e.getBoundingClientRect().left+e.getBoundingClientRect().width/2;return t<=window.innerWidth/2+e.getBoundingClientRect().width/window.elementScale/2&&t>=window.innerWidth/2-e.getBoundingClientRect().width/window.elementScale/3}(e)?e.classList.remove("stories-el_active"):(e.classList.add("stories-el_active"),window.countIndex=t)})))})),c.addEventListener("mouseup",v),c.addEventListener("mouseleave",v))}export function rightMovement(e){let t=document.querySelectorAll(".galleri .galleri__el").length,r=window.countIndex,o=document.querySelectorAll(".galleri .galleri__el")[r];if(console.log(r),document.querySelectorAll(".galleri .galleri__el").forEach((e=>{e.classList.remove("stories-el_active")})),window.buttons){if(window.countIndex<=1){let t=e.parentElement.parentElement.querySelector(".stories-prev");t.removeAttribute("disabled"),t.classList.remove("btn_disabled"),t.classList.add("stories-el_active")}if(window.countIndex===t-2){let t=e.parentElement.parentElement.querySelector(".stories-next");t.setAttribute("disabled",!0),t.classList.add("btn_disabled")}}r<t-1&&(r+=1,window.countIndex+=1,o=document.querySelectorAll(".galleri .galleri__el")[r],o.classList.add("stories-el_active"),getDistanceStories(o,e))}export function leftMovement(e){let t=document.querySelectorAll(".galleri .galleri__el").length,r=window.countIndex;console.log(r),window.buttons&&(window.countIndex===t-1&&(e.parentElement.parentElement.querySelector(".stories-next").removeAttribute("disabled"),e.parentElement.parentElement.querySelector(".stories-next").classList.remove("btn_disabled")),1===window.countIndex&&(e.parentElement.parentElement.querySelector(".stories-prev").setAttribute("disabled",!0),e.parentElement.parentElement.querySelector(".stories-prev").classList.add("btn_disabled")));let o=document.querySelectorAll(".galleri .galleri__el")[window.countIndex];document.querySelectorAll(".galleri .galleri__el").forEach((e=>{e.classList.remove("stories-el_active")})),0!=window.countIndex&&(window.countIndex-=1,o=document.querySelectorAll(".galleri .galleri__el")[window.countIndex],o.classList.add("stories-el_active"),getDistanceStories(o,e))}function remClassContainer(e){return new Promise((t=>{e.classList.remove("stories-container_active"),t()}))}function remFromBody(e){document.body.removeChild(e)}export async function delStoriesContainer(e){await remClassContainer(e),setTimeout((()=>{remFromBody(e)}),300)}export function storiesExit(e,t,r,o,n,i,l,s){e.addEventListener("click",(()=>{closeStories(t,r,o,n,i,l,s)}))}export function storiesExitBtn(){let e=document.createElement("button");e.classList.add("close-gallery");const t=(new DOMParser).parseFromString('<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.63599 18.364L18.3639 5.63603M5.63599 5.63604L18.3639 18.364" stroke="black" stroke-width="1.5" stroke-linecap="round"/></svg>',"image/svg+xml").querySelector("svg");return e.append(t),e}export function closeStories(e,t,r,o,n,i,l){document.removeEventListener("keydown",n),document.removeEventListener("touchstart",i),document.removeEventListener("touchend",l),window.countIndex=void 0,delStoriesContainer(r),enableScroll(),o.classList.remove("galleri_transform"),window.buttons&&setTimeout((()=>{o.parentElement.parentElement.querySelector(".stories-prev").removeAttribute("disabled"),o.parentElement.parentElement.querySelector(".stories-prev").classList.remove("btn_disabled"),o.parentElement.parentElement.querySelector(".stories-next").removeAttribute("disabled"),o.parentElement.parentElement.querySelector(".stories-next").classList.remove("btn_disabled")}),300)}export function sliderOpen(e){document.querySelectorAll(".galleri .galleri__el").forEach(((t,r)=>{t.addEventListener("click",(t=>{document.querySelectorAll(".galleri .galleri__el").forEach((e=>{e.classList.remove("stories-el_active")})),window.countIndex=r,t.currentTarget.classList.add("stories-el_active"),getDistanceStories(t.currentTarget,e),window.buttons&&(0==window.countIndex?(e.parentElement.parentElement.querySelector(".stories-prev").setAttribute("disabled",!0),e.parentElement.parentElement.querySelector(".stories-prev").classList.add("btn_disabled")):(e.parentElement.parentElement.querySelector(".stories-prev").removeAttribute("disabled"),e.parentElement.parentElement.querySelector(".stories-prev").classList.remove("btn_disabled")),window.countIndex==e.querySelectorAll(".galleri__el").length-1?(e.parentElement.parentElement.querySelector(".stories-next").setAttribute("disabled",!0),e.parentElement.parentElement.querySelector(".stories-next").classList.add("btn_disabled")):(e.parentElement.parentElement.querySelector(".stories-next").removeAttribute("disabled"),e.parentElement.parentElement.querySelector(".stories-next").classList.remove("btn_disabled")))}))}))}let scrollPosition=0,bodyEl=document.querySelector("body");export function disableScroll(){scrollPosition=window.pageYOffset,bodyEl.style.overflow="hidden",bodyEl.style.position="fixed",bodyEl.style.top=`-${scrollPosition}px`,bodyEl.style.width="100%"}export function enableScroll(){bodyEl.style.removeProperty("overflow"),bodyEl.style.removeProperty("position"),bodyEl.style.removeProperty("top"),bodyEl.style.removeProperty("width"),window.scrollTo(0,scrollPosition)}export function storiesGallery(e){let t=document.createElement("div");return t.classList.add("galleri"),t.style.setProperty("--galleri-gap",e),t.classList.add("galleri-opened"),t}export function storiesContainerEl(){let e=document.createElement("div");return document.body.append(e),e.classList.add("stories-container"),setTimeout((()=>{e.classList.add("stories-container_active")}),100),e}export function fillSlider(e,t,r,o,n){e.forEach((e=>{let i=document.createElement("div");if(n&&window.innerWidth>=768?(i.classList.add("galleri__el"),i.classList.add("galleri__el_stories"),i.style.setProperty("--img-scale",r)):(i.classList.add("galleri__el"),i.style.setProperty("--img-scale",r)),e.hasAttribute("data-video-el")){let r=document.createElement("video"),l=document.createElement("source"),s=document.createElement("source");o&&(window.innerWidth<=768?(l.setAttribute("src",e.getAttribute("data-src-mob-mp4")),s.setAttribute("src",e.getAttribute("data-src-mob-webm")),r.muted="muted",r.style.width="100%",r.controls=!0):(l.setAttribute("src",e.getAttribute("data-src-mp4")),l.setAttribute("type","video/mp4"),s.setAttribute("src",e.getAttribute("data-src-webm")),s.setAttribute("type","video/webm"))),n&&(l.setAttribute("src",e.getAttribute("data-src-mob-mp4")),l.setAttribute("type","video/mp4"),s.setAttribute("src",e.getAttribute("data-src-mob-webm")),s.setAttribute("type","video/webm")),n||o||(l.setAttribute("src",e.getAttribute("data-src-mp4")),l.setAttribute("type","video/mp4"),s.setAttribute("src",e.getAttribute("data-src-webm")),s.setAttribute("type","video/webm")),r.setAttribute("loop",!0),r.setAttribute("playsinline",!0),r.appendChild(l),r.appendChild(s),r.setAttribute("preload",!0),i.append(r),t.append(i)}else{let r=document.createElement("img");r.setAttribute("src",e.getAttribute("src")),i.append(r),t.append(i)}}))}export const appHeight=()=>{document.documentElement.style.setProperty("--app-height",`${window.innerHeight}px`)};export class croakSlider{constructor(e){this.stories=!1,this.buttons=!1,this.keyboard=!1,this.gap,this.scale,this.opacity,this.DOMElement,this.mobileVideo=!1,this.deskStories=!1,this.deskSwipe=!1,this.deskSwipeFocus=!1,Object.entries(e).forEach((e=>{"stories"===e[0]&&(this.stories=!0,e[1].DOMElement&&(this.DOMElement=e[1].DOMElement),e[1].buttons&&(this.buttons=e[1].buttons),e[1].keyboard&&(this.keyboard=e[1].keyboard),e[1].gap&&(this.gap=`${e[1].gap}px`),e[1].scale&&(this.scale=e[1].scale,window.elementScale=this.scale),e[1].opacity&&(this.opacity=e[1].opacity),!0===e[1].mobileVideo&&(this.mobileVideo=!0),!0===e[1].deskStories&&(this.deskStories=!0),!0===e[1].deskSwipe&&(window.deskSwipe=!0),!0===e[1].deskSwipeFocus&&(window.deskSwipeFocus=!0))})),console.log(this.mobileVideo),window.countIndex=void 0,window.buttons=this.buttons,window.keyboard=this.keyboard,this.DOMElement&&document.querySelectorAll(this.DOMElement).forEach((e=>{e.querySelectorAll("[data-el], [data-video-el]").forEach(((e,t,r)=>{e.addEventListener("click",(()=>{console.log(e+`${t}`),window.countIndex=t,setTimeout((()=>{disableScroll()}),350);let o=storiesGallery(this.gap);fillSlider(r,o,this.scale,this.mobileVideo,this.deskStories);let n=storiesExitBtn(),i=storiesContainerEl(),l=document.createElement("div");l.classList.add("stories-wrapper"),i.appendChild(l),l.appendChild(o),i.appendChild(n),i.style.setProperty("--galleri-opacity",this.opacity),o&&(document.querySelectorAll(".galleri .galleri__el").forEach((e=>{e.classList.remove("stories-el_active")})),document.querySelectorAll(".galleri .galleri__el")[window.countIndex].classList.add("stories-el_active"),getDistanceStories(document.querySelectorAll(".galleri .galleri__el")[window.countIndex],o),setTimeout((()=>{o.classList.add("galleri_transform")}),200));let s=50,d=0,a=0;function c(e){d=e.touches[0].clientX,a=e.touches[0].clientY}function u(e){let t=e.changedTouches[0].clientX,r=e.changedTouches[0].clientY,n=d-t,i=a-r;if(Math.abs(n-i)>0&&Math.abs(n)>s)if(n>0){if(window.countIndex===o.querySelectorAll(".galleri__el").length-1)return;rightMovement(o)}else if(n<0){if(0===window.countIndex)return;leftMovement(o)}}function m(e){"ArrowRight"===e.key&&window.countIndex!==r.length-1&&rightMovement(o),"ArrowLeft"===e.key&&0!==window.countIndex&&leftMovement(o),"d"===e.key&&window.countIndex!==r.length-1&&rightMovement(o),"a"===e.key&&0!==window.countIndex&&leftMovement(o),"Escape"===e.key&&(console.log("escape"),closeStories(d,a,i,o,m,c,u))}if(storiesExit(n,d,a,i,o,m,c,u),window.buttons){let e=document.querySelector(this.DOMElement).querySelector(".stories-prev").cloneNode(),t=document.querySelector(this.DOMElement).querySelector(".stories-next").cloneNode();i.appendChild(e),i.appendChild(t),e.classList.add("custom-left"),t.classList.add("custom-right"),0==window.countIndex?(o.parentElement.parentElement.querySelector(".stories-prev").setAttribute("disabled",!0),o.parentElement.parentElement.querySelector(".stories-prev").classList.add("btn_disabled")):window.countIndex==o.querySelectorAll(".galleri__el").length-1&&(console.log(window.countIndex),o.parentElement.parentElement.querySelector(".stories-next").setAttribute("disabled",!0),o.parentElement.parentElement.querySelector(".stories-next").classList.add("btn_disabled")),e.addEventListener("click",(()=>{leftMovement(o)})),t.addEventListener("click",(()=>{rightMovement(o)}))}window.keyboard&&(document.addEventListener("keydown",m),window.innerWidth<=768&&document.removeEventListener("keydown",m)),document.addEventListener("touchstart",c),document.addEventListener("touchend",u),sliderOpen(o)}))}))}))}}appHeight(),window.addEventListener("resize",appHeight);

let frog = new croakSlider({
  stories: {
    DOMElement: "div[data-croak-container]",
    gap: 50,
    scale: .75,
    opacity: 0.95,
    //mobileVideo: true,
    deskStories: true,
    deskSwipe: true,
    keyboard: true,
    deskSwipeFocus: true,
    //buttons: true,
  },
});
